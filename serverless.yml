service:
  name: rota

provider:
  name: aws
  runtime: nodejs12.x
  versionFunctions: false
  region: ${opt:region}
  stackTags:
    tenant: platform
    feature: rota
    service: rota
    owner: Mohit K.
  environment:
    WEBHOOK_URL: ${file(./env.yml):WEBHOOK_URL}
    ACCOUNT_ID: !Ref AWS::AccountId
    CHANNEL_NAME: ${file(./env.yml):CHANNEL_NAME}
    stage: ${opt:stage}
    region: ${opt:stage}
  iamRoleStatements:
    - Effect: 'Allow'
      Action:
        - 'logs:*'
        - 'lambda:InvokeFunction'
        - 'dynamodb:*'
        - 'secretsmanager:GetSecretValue'
      Resource: '*'

functions:
  pickMember:
    handler: src/handler/pick-member.pickMember
    events:
      - schedule:
          rate: cron(0 8 ? * MON-FRI *)
          enabled: false
          input:
            teamName: devops
            source: cloudwatch
  markUnavailable:
    handler: src/handler/mark-unavailable.markUnavailable